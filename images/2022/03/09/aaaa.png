import requests
import base64
import json
import uuid
import datetime
import os
import sys

ext = ""
os.system('cp "%s" ./' % sys.argv[1])
# 从文件夹下 读取文件
def read_dir():
    global ext
    path = "/home/zzy/Desktop/新建文件夹/"  # 指定的文件夹目录(自己随意) todo
    files = os.listdir(path)# 得到文件夹下的所有文件名称

    for file in files:  # 遍历文件夹
        if not os.path.isdir(file):  # 判断是否是文件夹，不是文件夹才打开
            ext = os.path.splitext(file)[1]
            with open(path + "/" + file, 'rb') as f: # rb 二进制 读取
                fdata_tmp = file_base64(f.read())
                f.close()
                return fdata_tmp # 只取第一个 文件，太懒了，就默认第一个



# 将文件转换为base64编码，github上传文件必须将文件以base64格式上传
def file_base64(data):
    data_b64 = base64.b64encode(data).decode()
    return data_b64


# 上传文件
def upload_file(file_data):
    global ext
    file_name = sys.argv[1].split('/')[-1]  # 文件名 随机生成
    # token = "[token]" todo
    # url = "https://api.github.com/repos/[user]/[repo]/contents/[path]/"+file_name  # 用户名、库名、路径
    # headers = {"Authorization": "token " + token}
    token = "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" ## 自行去github生成token，不懂得文章最好会写
    curr_time = datetime.datetime.now()
    path = curr_time.strftime("images/%Y/%m/%d")
    url = "https://api.github.com/repos/zzy-ac/My-Selves-Cloud/contents/" + path + "/" + file_name  # 用户名、库名、路径
    headers = {"Authorization": "token " + token} # github token 的规则 在2021-9-29 变调了，注意官方文档的说明哦
    content = file_data
    data = {
        "message": "zj upload pictures",
        "content": content
    }
    data = json.dumps(data)
    req = requests.put(url=url, data=data, headers=headers)
    req.encoding = "utf-8"
    re_data = json.loads(req.text)
    print("https://zzy-ac1.coding.net/t/zzy-ac1/p/import-p2i9/d/My-Selves-Cloud/git/raw/main/" + path + "/" + file_name)
    # ！======= 千万注意路径，别写错了 ，# 在国内无法访问文件图片啊，太慢，有时候直接无法访问，使用CDN访问，能有效解决这个问题，关键jsdelivr cdn 还是免费的，不能浪费哈





if __name__ == '__main__':
    # 从文件夹 读取文件
    fdata = read_dir()
    
    upload_file(fdata)




 
